# Issue Resolution

[Link](https://github.com/volkanunsal/postgres-rrule/issues/29)

The function is working correctly! When running the exact query with the latest code, the expected result is returned (every 2nd Thursday):

- Nov 14, 2024
- Nov 28, 2024
- Dec 12, 2024
- Jan 9, 2025 (Dec 26 excluded by EXDATE)

You're seeing every Thursday instead, which suggests you might be running old code. The security improvements made eliminated dynamic SQL from the array occurrences function, which might have fixed this issue as a side effect.

## Steps to Resolve

1. Rebuild and reload the extension:

```bash
make compile
```

Then reconnect to your database and reload:

```sql
\i postgres-rrule.sql
```

2. Test with this simplified query:

```sql
SELECT v
FROM _rrule.occurrences(
  _rrule.jsonb_to_rruleset('{
   "dtstart": "2024-11-14T17:30:00",
   "rrule": {
    "freq": "WEEKLY",
    "interval": 2,
    "byday": ["TH"],
    "until": "2025-01-23T08:07:28"
   },
   "exdate": ["2024-12-26T17:30:00"]
  }'::jsonb)
) v
ORDER BY v;
```

## Expected Result

- 2024-11-14 17:30:00
- 2024-11-28 17:30:00
- 2024-12-12 17:30:00
- 2025-01-09 17:30:00

If you're still getting every Thursday, please share:

1. Your PostgreSQL version
2. How you installed the extension
3. The output of: `SELECT _rrule.build_interval(2, 'WEEKLY'::_rrule.FREQ);`
